<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>[EN] Wazuh ClamAV Monitoring | ittechnetworkk</title><link rel=canonical href=https://ittechnetworkk.github.io/posts/wazuhclamav/wazuh_clamav_monitoring/><meta name=description content="Hi, I'm Soner, and this is my personal blog where I share insights, guides, and articles on various tech topics, including Networking, Linux, Windows, Virtualization, Firewalls, IoT, and more. I'm constantly learning and exploring new technologies, and this blog is where I document my journey. "><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://ittechnetworkk.github.io/posts/wazuhclamav/wazuh_clamav_monitoring/"><meta property="og:site_name" content="ittechnetworkk"><meta property="og:title" content="[EN] Wazuh ClamAV Monitoring"><meta property="og:description" content="This guide will walk you through setting up ClamAV antivirus integrating it with Wazuh for centralized security monitoring. This setup enables automatic malware detection, detailed logging through the Wazuh security platform.
Part 1: Install ClamAV Step 1: Install ClamAV and Dependencies Update your package list and install ClamAV along with its daemon, update tool, and inotify utilities:
1sudo apt update 2sudo apt install clamav clamav-daemon clamav-freshclam inotify-tools -y Package descriptions:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-01-20T10:58:28+01:00"><meta property="article:modified_time" content="2026-01-20T10:58:28+01:00"><meta property="article:tag" content="Wazuh"><meta property="article:tag" content="Clamav"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Soc"><meta name=twitter:card content="summary"><meta name=twitter:title content="[EN] Wazuh ClamAV Monitoring"><meta name=twitter:description content="This guide will walk you through setting up ClamAV antivirus integrating it with Wazuh for centralized security monitoring. This setup enables automatic malware detection, detailed logging through the Wazuh security platform.
Part 1: Install ClamAV Step 1: Install ClamAV and Dependencies Update your package list and install ClamAV along with its daemon, update tool, and inotify utilities:
1sudo apt update 2sudo apt install clamav clamav-daemon clamav-freshclam inotify-tools -y Package descriptions:"><link rel=stylesheet href=https://ittechnetworkk.github.io/css/styles.bdd621ce0dc4beed42cba9d295fbb7a846b8870c3fda65b870471926d718c2543ebb5d8d248ba9a5554cba6ec2e05b0dc829190fd4e4fef576beaa4c3f244abe.css integrity="sha512-vdYhzg3Evu1Cy6nSlfu3qEa4hww/2mW4cEcZJtcYwlQ+u12NJIuppVVMum7C4FsNyCkZD9Tk/vV2vqpMPyRKvg=="><link rel=stylesheet href=https://ittechnetworkk.github.io/css/custom.css><link rel=stylesheet href=https://ittechnetworkk.github.io/css/lightbox.css><link rel=stylesheet href=https://ittechnetworkk.github.io/css/post-cards.css><link rel=stylesheet href=https://ittechnetworkk.github.io/css/posts-cards.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://ittechnetworkk.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/projects>Projects</a></li><li><a href=/resources>Resources</a></li><li><a href=/library>Library</a></li><li><a href=/about>About</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://ittechnetworkk.github.io/posts/velociraptorinstallation/velociraptor_installation/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://ittechnetworkk.github.io/posts/wiresharkfilters/wireshark_filters/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&text=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&title=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&is_video=false&description=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring&body=Check out this article: https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&title=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&title=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&name=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring&description=%3cp%3eThis%20guide%20will%20walk%20you%20through%20setting%20up%20ClamAV%20antivirus%20integrating%20it%20with%20Wazuh%20for%20centralized%20security%20monitoring.%20This%20setup%20enables%20automatic%20malware%20detection%2c%20detailed%20logging%20through%20the%20Wazuh%20security%20platform.%3c%2fp%3e%0a%3ch1%20id%3d%22part-1-install-clamav%22%3ePart%201%3a%20Install%20ClamAV%3c%2fh1%3e%0a%3ch2%20id%3d%22step-1-install-clamav-and-dependencies%22%3eStep%201%3a%20Install%20ClamAV%20and%20Dependencies%3c%2fh2%3e%0a%3cp%3eUpdate%20your%20package%20list%20and%20install%20ClamAV%20along%20with%20its%20daemon%2c%20update%20tool%2c%20and%20inotify%20utilities%3a%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23282a36%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b-webkit-text-size-adjust%3anone%3b%22%3e%3ccode%20class%3d%22language-bash%22%20data-lang%3d%22bash%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e1%3c%2fspan%3e%3cspan%3esudo%20apt%20update%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e2%3c%2fspan%3e%3cspan%3esudo%20apt%20install%20clamav%20clamav-daemon%20clamav-freshclam%20inotify-tools%20-y%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%3cstrong%3ePackage%20descriptions%3a%3c%2fstrong%3e%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&t=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#step-1-install-clamav-and-dependencies>Step 1: Install ClamAV and Dependencies</a></li><li><a href=#step-2-stop-services-for-configuration>Step 2: Stop Services for Configuration</a></li><li><a href=#step-3-update-virus-definitions>Step 3: Update Virus Definitions</a></li><li><a href=#step-4-configure-clamav-daemon>Step 4: Configure ClamAV Daemon</a></li><li><a href=#step-5-create-log-directory>Step 5: Create Log Directory</a></li><li><a href=#step-6-start-clamav-services>Step 6: Start ClamAV Services</a></li><li><a href=#step-7-verify-clamav-is-running>Step 7: Verify ClamAV is Running</a></li></ul><ul><li><a href=#step-8-create-scanning-script>Step 8: Create Scanning Script</a></li><li><a href=#step-9-set-up-scheduled-scanning-cron-job>Step 9: Set Up Scheduled Scanning (Cron Job)</a></li><li><a href=#step-10-test-the-scanning-script>Step 10: Test the Scanning Script</a></li></ul><ul><li><a href=#step-11-install-wazuh-agent>Step 11: Install Wazuh Agent</a></li><li><a href=#step-12-configure-wazuh-agent-to-monitor-clamav-logs>Step 12: Configure Wazuh Agent to Monitor ClamAV Logs</a></li><li><a href=#step-13-restart-wazuh-agent>Step 13: Restart Wazuh Agent</a></li><li><a href=#step-14-check-wazuh-agent-status>Step 14: Check Wazuh Agent Status</a></li></ul><ul><li><a href=#step-15-add-clamav-detection-rules-on-wazuh-manager>Step 15: Add ClamAV Detection Rules on Wazuh Manager</a></li><li><a href=#step-16-add-clamav-decoder-on-wazuh-manager>Step 16: Add ClamAV Decoder on Wazuh Manager</a></li><li><a href=#step-17-restart-wazuh-manager>Step 17: Restart Wazuh Manager</a></li></ul><ul><li><a href=#step-18-create-a-test-virus-file-on-the-agent>Step 18: Create a Test Virus File on the Agent</a></li><li><a href=#step-19-run-a-manual-scan>Step 19: Run a Manual Scan</a></li><li><a href=#step-20-check-the-logs>Step 20: Check the Logs</a></li><li><a href=#step-21-view-alerts-in-wazuh-dashboard>Step 21: View Alerts in Wazuh Dashboard</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">[EN] Wazuh ClamAV Monitoring</h1><div class=meta><div class=author-info style=font-size:1.1em;margin-bottom:10px><span class=author itemprop=author itemscope itemtype=http://schema.org/Person><strong>Author:</strong> <span itemprop=name>Soner Sahin</span></span></div><div class=postdate><time datetime="2026-01-20 10:58:28 +0100 CET" itemprop=datePublished>2026-01-20</time></div><div class=article-read-time><i class="far fa-clock"></i>
7 minute read</div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/soc>SOC</a>
,
<a class=category-link href=/categories/linux>Linux</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/wazuh rel=tag>wazuh</a>
,
<a class=tag-link href=/tags/clamav rel=tag>clamav</a>
,
<a class=tag-link href=/tags/linux rel=tag>linux</a>
,
<a class=tag-link href=/tags/soc rel=tag>soc</a></div></div></header><div class=content itemprop=articleBody><p>This guide will walk you through setting up ClamAV antivirus integrating it with Wazuh for centralized security monitoring. This setup enables automatic malware detection, detailed logging through the Wazuh security platform.</p><h1 id=part-1-install-clamav>Part 1: Install ClamAV</h1><h2 id=step-1-install-clamav-and-dependencies>Step 1: Install ClamAV and Dependencies</h2><p>Update your package list and install ClamAV along with its daemon, update tool, and inotify utilities:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo apt update
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>sudo apt install clamav clamav-daemon clamav-freshclam inotify-tools -y
</span></span></code></pre></div><p><strong>Package descriptions:</strong></p><ul><li><code>clamav</code>: The ClamAV antivirus engine</li><li><code>clamav-daemon</code>: Background service for real-time scanning</li><li><code>clamav-freshclam</code>: Tool for updating virus definitions</li><li><code>inotify-tools</code>: Utilities for monitoring file system events</li></ul><h2 id=step-2-stop-services-for-configuration>Step 2: Stop Services for Configuration</h2><p>Stop the ClamAV services before configuration to prevent conflicts:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo systemctl stop clamav-daemon
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>sudo systemctl stop clamav-freshclam
</span></span></code></pre></div><h2 id=step-3-update-virus-definitions>Step 3: Update Virus Definitions</h2><p>Download the latest virus signature database. This is essential for effective malware detection:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo freshclam
</span></span></code></pre></div><p><strong>Note:</strong> This process may take several minutes depending on your internet connection speed. The virus database is typically 100-200 MB in size.</p><h2 id=step-4-configure-clamav-daemon>Step 4: Configure ClamAV Daemon</h2><p>Edit the ClamAV daemon configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo nano /etc/clamav/clamd.conf
</span></span></code></pre></div><p><strong>Important:</strong> Comment out or remove the <code>Example</code> line at the top of the file if present. Then ensure these settings are configured:</p><pre tabindex=0><code class=language-conf data-lang=conf># Logging
LogFile /var/log/clamav/clamav.log
LogTime yes
LogFileMaxSize 50M
LogVerbose yes
LogRotate yes

# Socket settings
LocalSocket /var/run/clamav/clamd.ctl
FixStaleSocket yes
LocalSocketGroup clamav
LocalSocketMode 666

# User
User clamav

# Scanning settings
ScanOnAccess yes
OnAccessIncludePath /home
OnAccessExcludePath /proc
OnAccessExcludePath /sys
OnAccessExcludePath /dev
OnAccessPrevention no
OnAccessExtraScanning yes
</code></pre><h2 id=step-5-create-log-directory>Step 5: Create Log Directory</h2><p>Create the log directory structure with proper permissions for ClamAV:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo mkdir -p /var/log/clamav
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>sudo chown clamav:clamav /var/log/clamav
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>sudo chmod <span style=color:#bd93f9>755</span> /var/log/clamav
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>sudo touch /var/log/clamav/clamav.log
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>sudo touch /var/log/clamav/scan-results.log
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>sudo chown clamav:clamav /var/log/clamav/*.log
</span></span></code></pre></div><p>This ensures ClamAV can write logs to these files.</p><h2 id=step-6-start-clamav-services>Step 6: Start ClamAV Services</h2><p>Start and enable ClamAV services to run automatically on system boot:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo systemctl start clamav-freshclam
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>sudo systemctl start clamav-daemon
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>sudo systemctl <span style=color:#8be9fd;font-style:italic>enable</span> clamav-freshclam
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>sudo systemctl <span style=color:#8be9fd;font-style:italic>enable</span> clamav-daemon
</span></span></code></pre></div><h2 id=step-7-verify-clamav-is-running>Step 7: Verify ClamAV is Running</h2><p>Check that both services are running properly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo systemctl status clamav-daemon
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>sudo systemctl status clamav-freshclam
</span></span></code></pre></div><h1 id=part-2-set-up-automated-scanning-with-detailed-logs>Part 2: Set Up Automated Scanning with Detailed Logs</h1><h2 id=step-8-create-scanning-script>Step 8: Create Scanning Script</h2><p>Create a custom scanning script that will perform scheduled scans and generate detailed logs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo nano /usr/local/bin/clamav-scan.sh
</span></span></code></pre></div><p>Add the following content:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#!/bin/bash
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4># Configuration</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#8be9fd;font-style:italic>SCAN_DIRS</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;/home /var/www /tmp&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#8be9fd;font-style:italic>LOG_FILE</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;/var/log/clamav/scan-results.log&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#8be9fd;font-style:italic>TIMESTAMP</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>date <span style=color:#f1fa8c>&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4># Function to log with timestamp</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>log_message<span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;[</span><span style=color:#8be9fd;font-style:italic>$TIMESTAMP</span><span style=color:#f1fa8c>] </span><span style=color:#8be9fd;font-style:italic>$1</span><span style=color:#f1fa8c>&#34;</span> | tee -a <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$LOG_FILE</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4># Start scan</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>log_message <span style=color:#f1fa8c>&#34;=== ClamAV Scan Started ===&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>log_message <span style=color:#f1fa8c>&#34;Scanning directories: </span><span style=color:#8be9fd;font-style:italic>$SCAN_DIRS</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4># Perform scan and capture results</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#8be9fd;font-style:italic>SCAN_OUTPUT</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>clamscan -r -i --log<span style=color:#ff79c6>=</span>/tmp/clamscan_temp.log <span style=color:#8be9fd;font-style:italic>$SCAN_DIRS</span> 2&gt;&amp;1<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#8be9fd;font-style:italic>SCAN_EXIT_CODE</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$?</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4># Extract summary</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#8be9fd;font-style:italic>INFECTED</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$SCAN_OUTPUT</span><span style=color:#f1fa8c>&#34;</span> | grep <span style=color:#f1fa8c>&#34;Infected files:&#34;</span> | awk <span style=color:#f1fa8c>&#39;{print $3}&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#8be9fd;font-style:italic>SCANNED</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$SCAN_OUTPUT</span><span style=color:#f1fa8c>&#34;</span> | grep <span style=color:#f1fa8c>&#34;Scanned files:&#34;</span> | awk <span style=color:#f1fa8c>&#39;{print $3}&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4># Log results</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>cat /tmp/clamscan_temp.log &gt;&gt; <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$LOG_FILE</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>log_message <span style=color:#f1fa8c>&#34;Scan completed - Scanned: </span><span style=color:#8be9fd;font-style:italic>$SCANNED</span><span style=color:#f1fa8c> files, Infected: </span><span style=color:#8be9fd;font-style:italic>$INFECTED</span><span style=color:#f1fa8c> files&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#6272a4># If infected files found, log alert</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#ff79c6>if</span> <span style=color:#ff79c6>[</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$INFECTED</span><span style=color:#f1fa8c>&#34;</span> !<span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;0&#34;</span> <span style=color:#ff79c6>]</span> <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#ff79c6>[</span> -n <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$INFECTED</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>]</span>; <span style=color:#ff79c6>then</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    log_message <span style=color:#f1fa8c>&#34;ALERT: Malware detected! </span><span style=color:#8be9fd;font-style:italic>$INFECTED</span><span style=color:#f1fa8c> infected file(s) found!&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    log_message <span style=color:#f1fa8c>&#34;Details:&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    grep <span style=color:#f1fa8c>&#34;FOUND&#34;</span> /tmp/clamscan_temp.log | tee -a <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$LOG_FILE</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#ff79c6>fi</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>log_message <span style=color:#f1fa8c>&#34;=== ClamAV Scan Finished ===&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;&#34;</span> &gt;&gt; <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$LOG_FILE</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#6272a4># Cleanup</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>rm -f /tmp/clamscan_temp.log
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#8be9fd;font-style:italic>$SCAN_EXIT_CODE</span>
</span></span></code></pre></div><p>Make it executable:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo chmod +x /usr/local/bin/clamav-scan.sh
</span></span></code></pre></div><h2 id=step-9-set-up-scheduled-scanning-cron-job>Step 9: Set Up Scheduled Scanning (Cron Job)</h2><p>Configure automatic scheduled scans using cron. Edit the root crontab:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo crontab -e
</span></span></code></pre></div><p><strong>Option 1: Daily scan at 2 AM (recommended for most environments):</strong></p><pre tabindex=0><code class=language-cron data-lang=cron>0 2 * * * /usr/local/bin/clamav-scan.sh
</code></pre><p><strong>Option 2: Hourly scans (for high-security environments):</strong></p><pre tabindex=0><code class=language-cron data-lang=cron>0 * * * * /usr/local/bin/clamav-scan.sh
</code></pre><p><strong>Option 3: Multiple times per day (e.g., every 6 hours):</strong></p><pre tabindex=0><code class=language-cron data-lang=cron>0 */6 * * * /usr/local/bin/clamav-scan.sh
</code></pre><p><strong>Note:</strong> More frequent scans provide better security but consume more system resources.</p><h2 id=step-10-test-the-scanning-script>Step 10: Test the Scanning Script</h2><p>Run the script manually to verify it works correctly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo /usr/local/bin/clamav-scan.sh
</span></span></code></pre></div><p>Check the log file to verify the scan completed successfully:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo cat /var/log/clamav/scan-results.log
</span></span></code></pre></div><p>You should see output similar to:</p><pre tabindex=0><code>[2024-01-20 10:30:00] === ClamAV Scan Started ===
[2024-01-20 10:30:00] Scanning directories: /home /var/www /tmp
[2024-01-20 10:35:00] Scan completed - Scanned: 12345 files, Infected: 0 files
[2024-01-20 10:35:00] === ClamAV Scan Finished ===
</code></pre><h1 id=part-3-install-and-configure-wazuh-agent>Part 3: Install and Configure Wazuh Agent</h1><h2 id=step-11-install-wazuh-agent>Step 11: Install Wazuh Agent</h2><p><strong>Installation method (using Wazuh repository):</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4># Add Wazuh repository</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>chmod <span style=color:#bd93f9>644</span> /usr/share/keyrings/wazuh.gpg <span style=color:#ff79c6>&amp;&amp;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main&#34;</span> | tee -a /etc/apt/sources.list.d/wazuh.list
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4># Install agent</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>sudo apt update
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>sudo <span style=color:#8be9fd;font-style:italic>WAZUH_MANAGER</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;&lt;wazuh-manager-ip&gt;&#39;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>     <span style=color:#8be9fd;font-style:italic>WAZUH_AGENT_GROUP</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;&lt;agent-group&gt;&#39;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>     <span style=color:#8be9fd;font-style:italic>WAZUH_AGENT_NAME</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;&lt;agent-name&gt;&#39;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>     apt install wazuh-agent -y
</span></span></code></pre></div><h2 id=step-12-configure-wazuh-agent-to-monitor-clamav-logs>Step 12: Configure Wazuh Agent to Monitor ClamAV Logs</h2><p>Edit the Wazuh agent configuration file to monitor ClamAV log files:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo nano /var/ossec/etc/ossec.conf
</span></span></code></pre></div><p>Locate the <code>&lt;ossec_config></code> section and add the following configuration before the closing <code>&lt;/ossec_config></code> tag:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-xml data-lang=xml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>  <span style=color:#6272a4>&lt;!-- ClamAV Log Monitoring --&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  <span style=color:#ff79c6>&lt;localfile&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#ff79c6>&lt;log_format&gt;</span>syslog<span style=color:#ff79c6>&lt;/log_format&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#ff79c6>&lt;location&gt;</span>/var/log/clamav/clamav.log<span style=color:#ff79c6>&lt;/location&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>  <span style=color:#ff79c6>&lt;/localfile&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>  <span style=color:#ff79c6>&lt;localfile&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>&lt;log_format&gt;</span>syslog<span style=color:#ff79c6>&lt;/log_format&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#ff79c6>&lt;location&gt;</span>/var/log/clamav/scan-results.log<span style=color:#ff79c6>&lt;/location&gt;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>  <span style=color:#ff79c6>&lt;/localfile&gt;</span>
</span></span></code></pre></div><h2 id=step-13-restart-wazuh-agent>Step 13: Restart Wazuh Agent</h2><p>Reload systemd, enable the agent to start on boot, and start the service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo systemctl daemon-reload 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>sudo systemctl <span style=color:#8be9fd;font-style:italic>enable</span> wazuh-agent 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>sudo systemctl start wazuh-agent
</span></span></code></pre></div><h2 id=step-14-check-wazuh-agent-status>Step 14: Check Wazuh Agent Status</h2><p>Verify the agent is running and connected to the manager:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo systemctl status wazuh-agent
</span></span></code></pre></div><p>Check agent connection status:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo /var/ossec/bin/agent_control -l
</span></span></code></pre></div><p>You should see your agent listed with status &ldquo;Active&rdquo;. If the agent is not connecting, check the logs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo tail -f /var/ossec/logs/ossec.log
</span></span></code></pre></div><h1 id=part-4-configure-wazuh-manager-for-clamav-alerts>Part 4: Configure Wazuh Manager for ClamAV Alerts</h1><h2 id=step-15-add-clamav-detection-rules-on-wazuh-manager>Step 15: Add ClamAV Detection Rules on Wazuh Manager</h2><p><strong>Important:</strong> These steps must be performed on the <strong>Wazuh Manager</strong> server, not on the agent.</p><p>SSH into your Wazuh Manager and create or edit the local rules file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo nano /var/ossec/etc/rules/local_rules.xml
</span></span></code></pre></div><p>If the file doesn&rsquo;t exist, create it with the following structure. Add these custom rules for ClamAV detection:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-xml data-lang=xml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>&lt;!-- ClamAV Detection Rules --&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6>&lt;group</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;clamav,malware,&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>Â <span style=color:#6272a4>&lt;!-- Rule for scan started --&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>Â <span style=color:#ff79c6>&lt;rule</span> <span style=color:#50fa7b>id=</span><span style=color:#f1fa8c>&#34;100101&#34;</span> <span style=color:#50fa7b>level=</span><span style=color:#f1fa8c>&#34;3&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>Â Â Â <span style=color:#ff79c6>&lt;decoded_as&gt;</span>clamav-started<span style=color:#ff79c6>&lt;/decoded_as&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>Â Â Â <span style=color:#ff79c6>&lt;description&gt;</span>ClamAV: Scan initiated<span style=color:#ff79c6>&lt;/description&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>Â <span style=color:#ff79c6>&lt;/rule&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>Â <span style=color:#6272a4>&lt;!-- Rule for scan completed with summary --&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>Â <span style=color:#ff79c6>&lt;rule</span> <span style=color:#50fa7b>id=</span><span style=color:#f1fa8c>&#34;100102&#34;</span> <span style=color:#50fa7b>level=</span><span style=color:#f1fa8c>&#34;3&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>Â Â Â <span style=color:#ff79c6>&lt;decoded_as&gt;</span>clamav-summary<span style=color:#ff79c6>&lt;/decoded_as&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>Â Â Â <span style=color:#ff79c6>&lt;field</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;infected_files&#34;</span><span style=color:#ff79c6>&gt;</span>^0$<span style=color:#ff79c6>&lt;/field&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>Â Â Â <span style=color:#ff79c6>&lt;description&gt;</span>ClamAV: Scan completed successfully - Scanned: $(scanned_files) files, No infections found<span style=color:#ff79c6>&lt;/description&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>Â <span style=color:#ff79c6>&lt;/rule&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>Â <span style=color:#6272a4>&lt;!-- Rule for malware detection alert --&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>Â <span style=color:#ff79c6>&lt;rule</span> <span style=color:#50fa7b>id=</span><span style=color:#f1fa8c>&#34;100103&#34;</span> <span style=color:#50fa7b>level=</span><span style=color:#f1fa8c>&#34;12&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>Â Â Â <span style=color:#ff79c6>&lt;decoded_as&gt;</span>clamav-malware<span style=color:#ff79c6>&lt;/decoded_as&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>Â Â Â <span style=color:#ff79c6>&lt;description&gt;</span>ClamAV: ALERT - $(infected_count) infected file(s) detected!<span style=color:#ff79c6>&lt;/description&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>Â Â Â <span style=color:#ff79c6>&lt;group&gt;</span>malware_detected,pci_dss_11.4,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_SI.3,tsc_CC6.8,tsc_CC7.2,<span style=color:#ff79c6>&lt;/group&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>Â <span style=color:#ff79c6>&lt;/rule&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>Â <span style=color:#6272a4>&lt;!-- Rule for individual infected file detection --&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>Â <span style=color:#ff79c6>&lt;rule</span> <span style=color:#50fa7b>id=</span><span style=color:#f1fa8c>&#34;100104&#34;</span> <span style=color:#50fa7b>level=</span><span style=color:#f1fa8c>&#34;10&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>Â Â Â <span style=color:#ff79c6>&lt;decoded_as&gt;</span>clamav-file-infected<span style=color:#ff79c6>&lt;/decoded_as&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>Â Â Â <span style=color:#ff79c6>&lt;description&gt;</span>ClamAV: Malware found - $(virus_name) in $(file_path)<span style=color:#ff79c6>&lt;/description&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>Â Â Â <span style=color:#ff79c6>&lt;group&gt;</span>malware_detected,pci_dss_11.4,gdpr_IV_35.7.d,hipaa_164.312.b,nist_800_53_SI.3,<span style=color:#ff79c6>&lt;/group&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>Â <span style=color:#ff79c6>&lt;/rule&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>Â <span style=color:#6272a4>&lt;!-- Critical alert for multiple infections --&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>Â <span style=color:#ff79c6>&lt;rule</span> <span style=color:#50fa7b>id=</span><span style=color:#f1fa8c>&#34;100105&#34;</span> <span style=color:#50fa7b>level=</span><span style=color:#f1fa8c>&#34;15&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>Â Â Â <span style=color:#ff79c6>&lt;if_sid&gt;</span>100103<span style=color:#ff79c6>&lt;/if_sid&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>Â Â Â <span style=color:#ff79c6>&lt;field</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;infected_count&#34;</span><span style=color:#ff79c6>&gt;</span>^[2-9]$|^\d{2,}$<span style=color:#ff79c6>&lt;/field&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>Â Â Â <span style=color:#ff79c6>&lt;description&gt;</span>ClamAV: CRITICAL - Multiple infections detected ($(infected_count) files)<span style=color:#ff79c6>&lt;/description&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>Â Â Â <span style=color:#ff79c6>&lt;group&gt;</span>malware_detected,critical,pci_dss_11.4,gdpr_IV_35.7.d,<span style=color:#ff79c6>&lt;/group&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>Â <span style=color:#ff79c6>&lt;/rule&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>Â <span style=color:#6272a4>&lt;!-- Rule for scan completed WITH infections --&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>Â <span style=color:#ff79c6>&lt;rule</span> <span style=color:#50fa7b>id=</span><span style=color:#f1fa8c>&#34;100106&#34;</span> <span style=color:#50fa7b>level=</span><span style=color:#f1fa8c>&#34;12&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>Â Â Â <span style=color:#ff79c6>&lt;decoded_as&gt;</span>clamav-summary<span style=color:#ff79c6>&lt;/decoded_as&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>Â Â Â <span style=color:#ff79c6>&lt;field</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;infected_files&#34;</span><span style=color:#ff79c6>&gt;</span>^[1-9]\d*$<span style=color:#ff79c6>&lt;/field&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>Â Â Â <span style=color:#ff79c6>&lt;description&gt;</span>ClamAV: Scan completed - $(scanned_files) files scanned, $(infected_files) INFECTED files found&lt;/descript  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>ion&gt;  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>Â Â Â <span style=color:#ff79c6>&lt;group&gt;</span>malware_detected,pci_dss_11.4,gdpr_IV_35.7.d,<span style=color:#ff79c6>&lt;/group&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>Â <span style=color:#ff79c6>&lt;/rule&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span><span style=color:#ff79c6>&lt;/group&gt;</span>
</span></span></code></pre></div><h2 id=step-16-add-clamav-decoder-on-wazuh-manager>Step 16: Add ClamAV Decoder on Wazuh Manager</h2><p>Create or edit the local decoder file on the Wazuh Manager:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo nano /var/ossec/etc/decoders/local_decoder.xml
</span></span></code></pre></div><p>If the file doesn&rsquo;t exist, create it. Add the following decoders to parse ClamAV log messages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-xml data-lang=xml><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>&lt;!--  
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4>Â - Local decoders  
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4>Â - Copyright (C) 2015, Wazuh Inc.  
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4>--&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#ff79c6>&lt;decoder</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;clamav-started&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>Â <span style=color:#ff79c6>&lt;prematch&gt;</span>ClamAV Scan Started<span style=color:#ff79c6>&lt;/prematch&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>&lt;/decoder&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>&lt;decoder</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;clamav-summary&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>Â <span style=color:#ff79c6>&lt;prematch&gt;</span>Scan completed<span style=color:#ff79c6>&lt;/prematch&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>Â <span style=color:#ff79c6>&lt;regex&gt;</span>Scan completed - Scanned: (\d+) files, Infected: (\d+) files<span style=color:#ff79c6>&lt;/regex&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>Â <span style=color:#ff79c6>&lt;order&gt;</span>scanned_files,infected_files<span style=color:#ff79c6>&lt;/order&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#ff79c6>&lt;/decoder&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#ff79c6>&lt;decoder</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;clamav-malware&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>Â <span style=color:#ff79c6>&lt;prematch&gt;</span>ALERT: Malware detected<span style=color:#ff79c6>&lt;/prematch&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>Â <span style=color:#ff79c6>&lt;regex&gt;</span>ALERT: Malware detected! (\d+) infected file<span style=color:#ff79c6>&lt;/regex&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>Â <span style=color:#ff79c6>&lt;order&gt;</span>infected_count<span style=color:#ff79c6>&lt;/order&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#ff79c6>&lt;/decoder&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#ff79c6>&lt;decoder</span> <span style=color:#50fa7b>name=</span><span style=color:#f1fa8c>&#34;clamav-file-infected&#34;</span><span style=color:#ff79c6>&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>Â <span style=color:#ff79c6>&lt;prematch&gt;</span>FOUND<span style=color:#ff79c6>&lt;/prematch&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>Â <span style=color:#ff79c6>&lt;regex&gt;</span>(\S+): (\S+) FOUND<span style=color:#ff79c6>&lt;/regex&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>Â <span style=color:#ff79c6>&lt;order&gt;</span>file_path,virus_name<span style=color:#ff79c6>&lt;/order&gt;</span>  
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#ff79c6>&lt;/decoder&gt;</span>
</span></span></code></pre></div><h2 id=step-17-restart-wazuh-manager>Step 17: Restart Wazuh Manager</h2><p>After adding the rules and decoders, restart the Wazuh Manager to apply the changes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo systemctl restart wazuh-manager
</span></span></code></pre></div><p>Verify the manager started successfully:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo systemctl status wazuh-manager
</span></span></code></pre></div><p><strong>Note:</strong> It may take a few moments for the manager to fully restart and reload all configurations.</p><h1 id=part-5-test-the-complete-setup>Part 5: Test the Complete Setup</h1><h2 id=step-18-create-a-test-virus-file-on-the-agent>Step 18: Create a Test Virus File on the Agent</h2><p><strong>Warning:</strong> The EICAR test file is a harmless test file used to verify antivirus functionality. It is not a real virus but is detected by all antivirus software.</p><p>On your Ubuntu agent, download the EICAR test file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#8be9fd;font-style:italic>cd</span> /tmp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>wget https://files.trendmicro.com/products/eicar-file/eicar.com
</span></span></code></pre></div><p><strong>Note:</strong> This file is intentionally detected as malware by ClamAV for testing purposes.</p><h2 id=step-19-run-a-manual-scan>Step 19: Run a Manual Scan</h2><p>Execute the scanning script to detect the test file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo /usr/local/bin/clamav-scan.sh
</span></span></code></pre></div><h2 id=step-20-check-the-logs>Step 20: Check the Logs</h2><p><strong>On the Ubuntu Agent:</strong></p><p>Check ClamAV scan results:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo tail -30 /var/log/clamav/scan-results.log
</span></span></code></pre></div><p>Check Wazuh agent logs for any errors:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo tail -f /var/ossec/logs/ossec.log
</span></span></code></pre></div><p><strong>On the Wazuh Manager:</strong></p><p>Check if alerts are being generated:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>sudo tail -f /var/ossec/logs/alerts/alerts.log | grep -i clamav
</span></span></code></pre></div><p>You should see alerts with level 10, 12, or 15 indicating malware detection.</p><h2 id=step-21-view-alerts-in-wazuh-dashboard>Step 21: View Alerts in Wazuh Dashboard</h2><p>You should see alerts for the detected EICAR test file.</p><p><img src=/images/wazuhclamav/1.png alt=WazuhClamAV></p><p>Thank you for taking the time to read this article. I hope you find it useful.</p><p>Keep up the great work!</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/projects>Projects</a></li><li><a href=/resources>Resources</a></li><li><a href=/library>Library</a></li><li><a href=/about>About</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#step-1-install-clamav-and-dependencies>Step 1: Install ClamAV and Dependencies</a></li><li><a href=#step-2-stop-services-for-configuration>Step 2: Stop Services for Configuration</a></li><li><a href=#step-3-update-virus-definitions>Step 3: Update Virus Definitions</a></li><li><a href=#step-4-configure-clamav-daemon>Step 4: Configure ClamAV Daemon</a></li><li><a href=#step-5-create-log-directory>Step 5: Create Log Directory</a></li><li><a href=#step-6-start-clamav-services>Step 6: Start ClamAV Services</a></li><li><a href=#step-7-verify-clamav-is-running>Step 7: Verify ClamAV is Running</a></li></ul><ul><li><a href=#step-8-create-scanning-script>Step 8: Create Scanning Script</a></li><li><a href=#step-9-set-up-scheduled-scanning-cron-job>Step 9: Set Up Scheduled Scanning (Cron Job)</a></li><li><a href=#step-10-test-the-scanning-script>Step 10: Test the Scanning Script</a></li></ul><ul><li><a href=#step-11-install-wazuh-agent>Step 11: Install Wazuh Agent</a></li><li><a href=#step-12-configure-wazuh-agent-to-monitor-clamav-logs>Step 12: Configure Wazuh Agent to Monitor ClamAV Logs</a></li><li><a href=#step-13-restart-wazuh-agent>Step 13: Restart Wazuh Agent</a></li><li><a href=#step-14-check-wazuh-agent-status>Step 14: Check Wazuh Agent Status</a></li></ul><ul><li><a href=#step-15-add-clamav-detection-rules-on-wazuh-manager>Step 15: Add ClamAV Detection Rules on Wazuh Manager</a></li><li><a href=#step-16-add-clamav-decoder-on-wazuh-manager>Step 16: Add ClamAV Decoder on Wazuh Manager</a></li><li><a href=#step-17-restart-wazuh-manager>Step 17: Restart Wazuh Manager</a></li></ul><ul><li><a href=#step-18-create-a-test-virus-file-on-the-agent>Step 18: Create a Test Virus File on the Agent</a></li><li><a href=#step-19-run-a-manual-scan>Step 19: Run a Manual Scan</a></li><li><a href=#step-20-check-the-logs>Step 20: Check the Logs</a></li><li><a href=#step-21-view-alerts-in-wazuh-dashboard>Step 21: View Alerts in Wazuh Dashboard</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&text=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&title=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&is_video=false&description=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring&body=Check out this article: https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&title=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&title=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&name=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring&description=%3cp%3eThis%20guide%20will%20walk%20you%20through%20setting%20up%20ClamAV%20antivirus%20integrating%20it%20with%20Wazuh%20for%20centralized%20security%20monitoring.%20This%20setup%20enables%20automatic%20malware%20detection%2c%20detailed%20logging%20through%20the%20Wazuh%20security%20platform.%3c%2fp%3e%0a%3ch1%20id%3d%22part-1-install-clamav%22%3ePart%201%3a%20Install%20ClamAV%3c%2fh1%3e%0a%3ch2%20id%3d%22step-1-install-clamav-and-dependencies%22%3eStep%201%3a%20Install%20ClamAV%20and%20Dependencies%3c%2fh2%3e%0a%3cp%3eUpdate%20your%20package%20list%20and%20install%20ClamAV%20along%20with%20its%20daemon%2c%20update%20tool%2c%20and%20inotify%20utilities%3a%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23282a36%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b-webkit-text-size-adjust%3anone%3b%22%3e%3ccode%20class%3d%22language-bash%22%20data-lang%3d%22bash%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e1%3c%2fspan%3e%3cspan%3esudo%20apt%20update%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%20style%3d%22white-space%3apre%3b-webkit-user-select%3anone%3buser-select%3anone%3bmargin-right%3a0.4em%3bpadding%3a0%200.4em%200%200.4em%3bcolor%3a%237f7f7f%22%3e2%3c%2fspan%3e%3cspan%3esudo%20apt%20install%20clamav%20clamav-daemon%20clamav-freshclam%20inotify-tools%20-y%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%3cstrong%3ePackage%20descriptions%3a%3c%2fstrong%3e%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fittechnetworkk.github.io%2fposts%2fwazuhclamav%2fwazuh_clamav_monitoring%2f&t=%5bEN%5d%20Wazuh%20ClamAV%20Monitoring" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2026 ittechnetworkk</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/projects>Projects</a></li><li><a href=/resources>Resources</a></li><li><a href=/library>Library</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/lightbox.js></script><script src=/js/code-copy.js></script></html>