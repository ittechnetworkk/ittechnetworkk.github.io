class CybersecurityAPIService{constructor(){this.apis={mitre:{baseUrl:"https://attack.mitre.org/api/",endpoints:{techniques:"techniques/enterprise/",groups:"groups/",software:"software/",tactics:"tactics/enterprise/"}},alienvault:{baseUrl:"https://otx.alienvault.com/api/v1/",endpoints:{pulses:"pulses/subscribed",indicators:"indicators/domain/",threatGroups:"threat-groups/"}},virustotal:{baseUrl:"https://www.virustotal.com/vtapi/v2/",endpoints:{ipReport:"ip-address/report",domainReport:"domain/report",fileReport:"file/report"}},threatfox:{baseUrl:"https://threatfox-api.abuse.ch/api/v1/",endpoints:{malware:"malware/",ioc:"ioc/"}},urlhaus:{baseUrl:"https://urlhaus-api.abuse.ch/v1/",endpoints:{payload:"payload/",url:"url/"}}},this.cache=new Map,this.cacheTimeout=30*60*1e3}async makeRequest(e,t={}){const s=e+JSON.stringify(t),n=this.cache.get(s);if(n&&Date.now()-n.timestamp<this.cacheTimeout)return n.data;try{const n=await fetch(e,{...t,headers:{"Content-Type":"application/json",...t.headers}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.json();return this.cache.set(s,{data:o,timestamp:Date.now()}),o}catch(t){throw console.error(`API request failed for ${e}:`,t),t}}async getMitreTechniques(){try{const e=this.apis.mitre.baseUrl+this.apis.mitre.endpoints.techniques,t=await this.makeRequest(e);return this.processMitreTechniques(t)}catch(e){return console.warn("Failed to load MITRE techniques:",e),this.getFallbackTechniques()}}async getMitreGroups(){try{const e=this.apis.mitre.baseUrl+this.apis.mitre.endpoints.groups,t=await this.makeRequest(e);return this.processMitreGroups(t)}catch(e){return console.warn("Failed to load MITRE groups:",e),this.getFallbackGroups()}}async getMitreSoftware(){try{const e=this.apis.mitre.baseUrl+this.apis.mitre.endpoints.software,t=await this.makeRequest(e);return this.processMitreSoftware(t)}catch(e){return console.warn("Failed to load MITRE software:",e),this.getFallbackSoftware()}}async getMitreTactics(){try{const e=this.apis.mitre.baseUrl+this.apis.mitre.endpoints.tactics,t=await this.makeRequest(e);return this.processMitreTactics(t)}catch(e){return console.warn("Failed to load MITRE tactics:",e),this.getFallbackTactics()}}async getAlienVaultPulses(e=10){try{const t=this.apis.alienvault.baseUrl+this.apis.alienvault.endpoints.pulses,n=await this.makeRequest(t+`?limit=${e}`);return this.processAlienVaultPulses(n)}catch(e){return console.warn("Failed to load AlienVault pulses:",e),[]}}async getAlienVaultIndicators(e){try{const t=this.apis.alienvault.baseUrl+this.apis.alienvault.endpoints.indicators+e,n=await this.makeRequest(t);return this.processAlienVaultIndicators(n)}catch(e){return console.warn("Failed to load AlienVault indicators:",e),[]}}async getVirusTotalReport(e,t,n){if(!n)return console.warn("VirusTotal API key not provided"),null;try{const s=this.apis.virustotal.endpoints[e+"Report"],o=this.apis.virustotal.baseUrl+s,i=await this.makeRequest(o,{method:"POST",body:JSON.stringify({apikey:n,resource:t})});return this.processVirusTotalReport(i)}catch(e){return console.warn("Failed to load VirusTotal report:",e),null}}async getThreatFoxMalware(){try{const e=this.apis.threatfox.baseUrl+this.apis.threatfox.endpoints.malware,t=await this.makeRequest(e,{method:"POST",body:JSON.stringify({query:"get_recent",days:1})});return this.processThreatFoxMalware(t)}catch(e){return console.warn("Failed to load ThreatFox malware:",e),[]}}async getURLhausPayloads(){try{const e=this.apis.urlhaus.baseUrl+this.apis.urlhaus.endpoints.payload,t=await this.makeRequest(e,{method:"POST",body:JSON.stringify({query:"recent",days:1})});return this.processURLhausPayloads(t)}catch(e){return console.warn("Failed to load URLhaus payloads:",e),[]}}processMitreTechniques(e){const t={};return e.forEach(e=>{const n=e.tactic||"unknown";t[n]||(t[n]=[]),t[n].push({id:e.technique_id,name:e.technique_name,description:e.technique_description,url:e.technique_url,platforms:e.platforms||[],permissions:e.permissions||[],data_sources:e.data_sources||[],detection:e.detection||[],mitigation:e.mitigation||[]})}),t}processMitreGroups(e){return e.map(e=>({id:e.group_id,name:e.group_name,description:e.group_description,url:e.group_url,techniques:e.techniques||[],aliases:e.aliases||[],country:e.country||"Unknown",first_seen:e.first_seen||"Unknown",last_seen:e.last_seen||"Unknown"}))}processMitreSoftware(e){return e.map(e=>({id:e.software_id,name:e.software_name,description:e.software_description,url:e.software_url,techniques:e.techniques||[],platforms:e.platforms||[],type:e.type||"Unknown"}))}processMitreTactics(e){return e.map(e=>({id:e.tactic_id,name:e.tactic_name,description:e.tactic_description,url:e.tactic_url}))}processAlienVaultPulses(e){return e.results?.map(e=>({id:e.id,name:e.name,description:e.description,tags:e.tags||[],indicators:e.indicators||[],created:e.created,modified:e.modified,author:e.author?.username||"Unknown"}))||[]}processAlienVaultIndicators(e){return e.indicators?.map(e=>({type:e.type,value:e.indicator,description:e.description,created:e.created,tags:e.tags||[]}))||[]}processVirusTotalReport(e){return{positives:e.positives,total:e.total,scans:e.scans,scan_date:e.scan_date,permalink:e.permalink}}processThreatFoxMalware(e){return e.query_status==="ok"?e.data?.map(e=>({id:e.id,name:e.malware,type:e.malware_type,platform:e.platform,first_seen:e.first_seen,last_seen:e.last_seen,status:e.status}))||[]:[]}processURLhausPayloads(e){return e.query_status==="ok"?e.data?.map(e=>({id:e.id,url:e.url,tags:e.tags||[],first_seen:e.first_seen,last_seen:e.last_seen,status:e.url_status}))||[]:[]}getFallbackTechniques(){return{reconnaissance:[{id:"T1595",name:"Active Scanning",description:"Scanning IP addresses, ports, and services"},{id:"T1592",name:"Gather Victim Host Information",description:"Collecting information about the target"}],"initial-access":[{id:"T1078",name:"Valid Accounts",description:"Using existing accounts to gain access"},{id:"T1190",name:"Exploit Public-Facing Application",description:"Exploiting vulnerabilities in applications"}]}}getFallbackGroups(){return[{id:"G0007",name:"APT29",description:"Russian state-sponsored threat group",country:"Russia",techniques:["T1078","T1059","T1071"]},{id:"G0006",name:"APT28",description:"Russian state-sponsored threat group",country:"Russia",techniques:["T1078","T1059","T1071"]}]}getFallbackSoftware(){return[{id:"S0001",name:"Mimikatz",description:"Credential dumping tool",type:"Tool",platforms:["Windows"]}]}getFallbackTactics(){return[{id:"TA0043",name:"Reconnaissance",description:"Gathering information to plan future operations"},{id:"TA0001",name:"Initial Access",description:"Getting into the network"}]}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,entries:Array.from(this.cache.keys())}}}window.cybersecurityAPI=new CybersecurityAPIService,typeof module!="undefined"&&module.exports&&(module.exports=CybersecurityAPIService)